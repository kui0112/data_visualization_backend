import{w as _,c as h,p as f,a as w}from"./Service-kX-x3XrH.js";import{d as x,u as k,r as d,o as I,b as N,e as D,f as B,h as m,i as O,j as P,_ as S}from"./index-CVbE00YX.js";const j={class:"pictures"},C=x({__name:"Pictures",setup(W){const y=k(),t=d(null),a=d(null),u=d(null);let s=null,l="",o=[],r=0,c=null,b=6*1e3;function v(){if(t.value&&o&&o.length>r){u.value.style.visibility="hidden",t.value.style.visibility="visible",a.value.style.visibility="visible";const i=o[r];t.value.src=w(i.image),t.value.onload=()=>{let e=i.subtitle,n=t.value.width;a.value.style.maxWidth=`${n-20}px`,a.value.textContent=e,r=(r+1)%o.length}}}function p(i){o=i,r=0,c&&clearInterval(c),c=setInterval(v,b),v()}const g=async i=>{if(y.currentRoute.value.name!=="Pictures")return;const e=JSON.parse(i.data);if(e.type==="heartbeat"){s.send("1");return}if(e.type==="command"&&e.operation==="update"&&(console.log("update command received."),l!==e.name&&e.name)){l=e.name;const n=await f(l);n.content&&(p(n.content),v())}};return I(async()=>{if(u.value.style.visibility="visible",a.value.style.visibility="hidden",t.value.style.visibility="hidden",t.value.onerror=n=>{u.value.style.visibility="visible",a.value.style.visibility="hidden",t.value.style.visibility="hidden"},s=await _(),s&&(s.onopen=async n=>{console.log("ws connected.")},s.onmessage=g),l=(await h()).content,!l)return;const e=await f(l);e.content&&p(e.content)}),N(async()=>{c&&clearInterval(c),s&&s.readyState===WebSocket.OPEN&&s.close()}),(i,e)=>{const n=P("a-spin");return D(),B("div",j,[m("div",{ref_key:"spinningDiv",ref:u,class:"spinning"},[O(n,{tip:"Loading...",spinning:!0,size:"large"})],512),m("img",{ref_key:"img",ref:t,alt:"image",class:"image",src:""},null,512),m("div",{ref_key:"subtitleDiv",ref:a,class:"subtitle"},null,512)])}}}),R=S(C,[["__scopeId","data-v-3f49465a"]]);export{R as default};
