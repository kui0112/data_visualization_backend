import{w as m,c as d,v as c}from"./Service-kX-x3XrH.js";import{d as p,u as v,r as x,o as g,b as y,e as S,f as w,h as _,_ as M}from"./index-CVbE00YX.js";const b="0000000000 0000000000 0000000000 0000000000 0000000000",z={value:b};let h=z.value.split(" ");const F=()=>h[Math.floor(Math.random()*h.length)],A=(a,e)=>a+Math.floor(Math.random()*e),l=a=>{h=a.split(" ")};class N{constructor(e,t){this.buffer=[],this.aliveFrames=0,this.x=e,this.y=t}reset(){this.y=1,this.buffer=[],this.aliveFrames=0}next(){if(this.aliveFrames=0,!this.buffer.length){this.buffer.push(" ".repeat(A(1,3)));let e=F();for(const t of e)this.buffer.push(t)}return this.buffer.shift()}}let V=class{constructor(){this.scale=.8,this.fps=20,this.transparencyStep=.01,this.fontSize=15,this.drops=[],this.timer=null,this.starterFlag=!0,this.counter=0,this.counterMaxValue=25,this.frames=0}initialize(e){this.canvas=e,this.canvas.width=window.innerWidth*this.scale,this.canvas.height=window.innerHeight*this.scale,this.ctx=this.canvas.getContext("2d"),this.ctx.font=`${this.fontSize}px SanFrancisco`,this.columns=this.canvas.width/this.fontSize,this.rows=this.canvas.height/this.fontSize;for(let t=0;t<this.columns;t++)this.drops.push(new N(t,1))}draw(){this.ctx.fillStyle=`rgba(0, 0, 0, ${this.transparencyStep})`,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);for(let e=0;e<this.drops.length;e++){const t=this.drops[e];this.ctx.fillStyle="rgba(0, 0, 0, 1)",this.ctx.fillRect(t.x*this.fontSize,(t.y-1)*this.fontSize,this.fontSize,this.fontSize),this.ctx.fillStyle="#ffffff",this.ctx.fillText(t.next(),t.x*this.fontSize,t.y*this.fontSize),t.y++,t.aliveFrames++,this.starterFlag&&t.y*this.fontSize>this.canvas.height&&e===0&&(this.counter++,this.counter>this.counterMaxValue&&(this.starterFlag=!1,this.fps=1,this.createMainLoop())),!this.starterFlag&&t.y*this.fontSize>this.canvas.height&&Math.random()>.95&&(t.y=0),this.frames++}}render(){this.ctx.fillStyle="rgba(0, 0, 0, 1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.createMainLoop()}reset(){this.timer!==null&&clearInterval(this.timer);for(let e=0;e<this.columns;e++)this.drops[e].reset();this.frames=0,this.counter=0,this.starterFlag=!0,this.fps=20}createMainLoop(){this.timer!==null&&clearInterval(this.timer),this.timer=setInterval(()=>{this.draw()},1e3/this.fps)}};const R={class:"canvasParent"},$=p({__name:"MatrixAnimation",setup(a){const e=v(),t=x(null),r=new V;let i=null,n="";const f=async o=>{if(e.currentRoute.value.name!=="VectorAnimation")return;const s=JSON.parse(o.data);if(s.type==="heartbeat"){i.send("1");return}if(s.type==="command"&&s.operation==="update"&&(console.log("update command received."),n!==s.name&&s.name)){n=s.name;const u=await c(n);l(u.content),r.reset(),r.render()}};return g(async()=>{if(i=await m(),i&&(i.onopen=async s=>{console.log("ws connected.")},i.onmessage=f),n=(await d()).content,n){const s=await c(n);l(s.content)}r.initialize(t.value),r.render()}),y(()=>{i&&i.readyState===WebSocket.OPEN&&i.close()}),(o,s)=>(S(),w("div",R,[_("canvas",{class:"canvas",ref_key:"canvas",ref:t},null,512)]))}}),O=M($,[["__scopeId","data-v-79fd4d73"]]);export{O as default};
